variables:
  - name: sourceDirectory
    value: $['Build.SourceDirectory']

parameters:
  - name: bicepDir
    default: $(bicepDir)
  - name: bicep_parameters_template
    type: object
    default:
      $schema: https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#
      contentVersion: '1.0.0.0'
      parameters:
        project:
          value: $(projectName)
        env:
          value: $(bicepParameter)
        location:
          value: $(location)
        workerSizeId:
          value: 0
        workerCount:
          value: 1

steps:
  - script: |
      echo "${JSON}" > main.parameters.$(bicepParameter).json
      file main.parameters.$(bicepParameter).json
      cat main.parameters.$(bicepParameter).json
    workingDirectory: $(bicepDir)
    env:
      JSON: ${{ convertToJson(parameters.bicep_parameters_template) }}
